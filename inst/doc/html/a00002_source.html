<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>Microsimulation API: /home/marcle/src/R/microsimulation/src/archive/cervical.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Microsimulation API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_05f47c3b30cbd06df5261c168690a0c6.html">archive</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">cervical.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a00002.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="a00056.html">microsimulation.h</a>&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;boost/algorithm/cxx11/iota.hpp&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="a00088.html">Rcpp</a>;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="a00078.html">ssim</a>;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="comment">// declarations</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keyword">enum</span> hpv_t {LR_HPV,HPV_16,HPV_18,Other_HR_HPV};</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keyword">enum</span> <a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a> {Normal, HPV, CIN1, CIN23, LocalCancer, RegionalCancer, DistantCancer, <a class="code" href="a00005.html#a17026bec7f574bca918d5f81939429bcab5c539648669b55ca8979ff5796e23d9">Death</a>};</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="keyword">enum</span> <a class="code" href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4">event_t</a> {toHPV, toCIN1, toNormal, toCIN23, toNoCIN, toLocalCancer, toRegionalCancer,</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        toDistantCancer, toUtility, toUtilityChange, <a class="code" href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4a43bf220160ef4fab6642d26f5d28ac27">toOtherDeath</a>, <a class="code" href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4ae5932500ab326a0d3bdd87449bb48d33">toCancerDeath</a>};</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="comment">// forward declarations</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="keyword">class </span>Person;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="keyword">class </span>HPV_infection;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="comment">// namespace FullState {</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="comment">//   typedef boost::tuple&lt;short,short,short,bool,double&gt; Type;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="comment">//   enum Fields {state, ext_grade, dx, psa_ge_3, cohort};</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="comment">//   // string names[5] = {&quot;state&quot;,&quot;ext_grade&quot;,&quot;dx&quot;,&quot;psa_ge_3&quot;,&quot;cohort&quot;};</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="comment">// EventReport&lt;FullState::Type,short,double&gt; report;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="comment">// typedef pair&lt;string,double&gt; CostKey;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="comment">// CostReport&lt;CostKey&gt; costs;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keyword">typedef</span> boost::tuple&lt;hpv_t,state_t,state_t&gt; H_key;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keyword">typedef</span> map&lt;H_key,NumericInterpolate&gt; H_t;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keyword">typedef</span> vector&lt;HPV_infection *&gt; infections_t;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keyword">class </span>SimInput {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordtype">bool</span> debug;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    H_t H;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="a01016.html">Rng</a> * rngNh, * rngOther, * rngScreen, * rngTreatment;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="a01012.html">Rpexp</a> rmu0;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    NumericVector parameter;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    LogicalVector bparameter;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    SimInput() {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      debug = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      rngNh = <span class="keyword">new</span> <a class="code" href="a01016.html">Rng</a>();</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      rngOther = <span class="keyword">new</span> <a class="code" href="a01016.html">Rng</a>();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      rngScreen = <span class="keyword">new</span> <a class="code" href="a01016.html">Rng</a>();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      rngTreatment = <span class="keyword">new</span> <a class="code" href="a01016.html">Rng</a>();</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    }</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">virtual</span> ~SimInput() {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keyword">delete</span> rngNh;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <span class="keyword">delete</span> rngOther;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keyword">delete</span> rngScreen;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="keyword">delete</span> rngTreatment;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  };</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">class </span>SimOutput {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="a01032.html">SimpleReport&lt;double&gt;</a> lifeHistories;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="a01032.html">SimpleReport&lt;double&gt;</a> outParameters;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  };</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// typedef Table&lt;boost::tuple&lt;double,double,int&gt;,double&gt; TablePrtx; // Age, DxY, G</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">// typedef Table&lt;boost::tuple&lt;int,double,double,int&gt;,double&gt; TablePradt;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">// typedef Table&lt;pair&lt;double,double&gt;,double&gt; TableBiopsyCompliance;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">// typedef Table&lt;pair&lt;double,double&gt;,double&gt; TableDDD; // as per TableBiopsyCompliance</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">// typedef map&lt;int,NumericInterpolate&gt; H_dist_t;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="comment">// typedef map&lt;pair&lt;double,int&gt;,NumericInterpolate&gt; H_local_t;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">// TablePrtx prtxCM, prtxRP;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// TablePradt pradt;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// TableBiopsyCompliance tableOpportunisticBiopsyCompliance, tableFormalBiopsyCompliance;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// TableDDD rescreen_shape, rescreen_scale, rescreen_cure;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">// NumericInterpolate interp_prob_grade7;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// H_dist_t H_dist;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// H_local_t H_local;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// set&lt;double,greater&lt;double&gt; &gt; H_local_age_set;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keyword">class </span>cMessageByHPV : <span class="keyword">public</span> <a class="code" href="a01000.html">cMessage</a> {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    cMessageByHPV(<a class="code" href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4">event_t</a> event, hpv_t hpv) : <a class="code" href="a01000.html">cMessage</a>(event), hpv(hpv) { }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    hpv_t hpv;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  };</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> cMessageHPVPred(<span class="keyword">const</span> <a class="code" href="a01076.html">ssim::Event</a>* e, <span class="keyword">const</span> hpv_t hpv) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keyword">const</span> cMessageByHPV * msg = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>cMessageByHPV *<span class="keyword">&gt;</span>(e);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">return</span> (msg != 0 &amp;&amp; msg-&gt;hpv == hpv); </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> cMessageAnyHPVPred(<span class="keyword">const</span> <a class="code" href="a01076.html">ssim::Event</a>* e) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">return</span> (<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>cMessageByHPV *<span class="keyword">&gt;</span>(e) != 0); </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keyword">class </span>cMessageUtilityChange : <span class="keyword">public</span> <a class="code" href="a01000.html">cMessage</a> {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    cMessageUtilityChange(<span class="keywordtype">double</span> change) : <a class="code" href="a01000.html">cMessage</a>(toUtilityChange), change(change) { }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordtype">double</span> change;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  };</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keyword">class </span>cMessageUtility : <span class="keyword">public</span> <a class="code" href="a01000.html">cMessage</a> {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    cMessageUtility(<span class="keywordtype">double</span> utility) : <a class="code" href="a01000.html">cMessage</a>(toUtility), utility(utility) { }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordtype">double</span> utility;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  };</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// utilities</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  T bounds(T x, T a, T b) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">return</span> (x&lt;a)?a:((x&gt;b)?b:x);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  T max(T left, T right) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">return</span> (left&lt;right) ? right : left;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keyword">class </span>HPV_infection : <span class="keyword">public</span> <a class="code" href="a01004.html">cProcess</a></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    hpv_t hpv;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a> state;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">bool</span> ever_infected, immunity;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">double</span> p_immunity;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    Person * person;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    SimInput * in;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    SimOutput * out;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    HPV_infection(hpv_t hpv = LR_HPV, <span class="keywordtype">double</span> p_immunity = 1.0) : </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      hpv(hpv), p_immunity(p_immunity) {}</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">double</span> event_time(<a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a> from, <a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a> to);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">void</span> init();</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> handleMessage(<span class="keyword">const</span> <a class="code" href="a01000.html">cMessage</a>* msg);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordtype">void</span> removeEvents() {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      Sim::ignore_event(boost::bind(cMessageHPVPred,_1,hpv));</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  };</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keyword">class </span>Person : <span class="keyword">public</span> <a class="code" href="a01004.html">cProcess</a> </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    SimInput * in;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    SimOutput * out;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">int</span> id;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordtype">double</span> cohort, utility;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordtype">bool</span> dx;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a> state;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    infections_t infections;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    Person(SimInput * in = NULL, SimOutput * out = NULL, <span class="keyword">const</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0, <span class="keyword">const</span> <span class="keywordtype">double</span> cohort = 1950) : </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      in(in), out(out), id(id), cohort(cohort), utility(1.0) { }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordtype">void</span> init();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> handleMessage(<span class="keyword">const</span> <a class="code" href="a01000.html">cMessage</a>* msg);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">void</span> link(HPV_infection * infection) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      infection-&gt;out = out;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      infection-&gt;in = in;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      infections.push_back(infection);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      infection-&gt;person=<span class="keyword">this</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a> max_infection_state();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">void</span> removeHPVevents() {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="comment">// for (infections_t::iterator it = infections.begin(); it!=infections.end(); ++it)</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="comment">//    (*it)-&gt;removeEvents();</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      Sim::ignore_event(cMessageAnyHPVPred);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// void add_costs(string item);</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// void scheduleUtilityChange(double at, std::string category, bool transient = true, </span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">//                 double sign = -1.0);</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  };</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">// state_t Person::max_infection_state() {</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="comment">//   int max_value = (int) Normal;</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="comment">//   for (vector&lt;HPV_infection *&gt;::iterator it = infections.begin(); it!=infections.end(); ++it)</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">//     max_value = max&lt;int&gt;((int) (*it)-&gt;state, max_value);</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">//   return (state_t) max_value;</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordtype">double</span> HPV_infection::event_time(<a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a> from, <a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a> to) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">return</span> in-&gt;H[H_key(hpv,from,to)].invert(-log(R::runif(0.0,1.0)),<a class="code" href="a00078.html#a4f5da079da642a3ab4bc28f4f307a9d1">now</a>());</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">void</span> HPV_infection::init() {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// initialise state</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    state = Normal;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    ever_infected = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    immunity = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// determine event times</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    in-&gt;rngNh-&gt;set();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    scheduleAt(event_time(Normal,HPV), <span class="keyword">new</span> cMessageByHPV(toHPV,hpv));</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordtype">void</span> HPV_infection::handleMessage(<span class="keyword">const</span> <a class="code" href="a01000.html">cMessage</a>* msg) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    in-&gt;rngNh-&gt;set();</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (person-&gt;id &lt; in-&gt;parameter[<span class="stringliteral">&quot;nLifeHistories&quot;</span>]) { <span class="comment">// only record up to the first n individuals</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      out-&gt;lifeHistories.record(<span class="stringliteral">&quot;id&quot;</span>,person-&gt;id);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      out-&gt;lifeHistories.record(<span class="stringliteral">&quot;time&quot;</span>,<a class="code" href="a00078.html#a4f5da079da642a3ab4bc28f4f307a9d1">now</a>());</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      out-&gt;lifeHistories.record(<span class="stringliteral">&quot;hpv&quot;</span>,hpv);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      out-&gt;lifeHistories.record(<span class="stringliteral">&quot;event&quot;</span>,msg-&gt;<a class="code" href="a01000.html#a9de1f2958f2bdc0d9ecfeb44c396c921">kind</a>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">switch</span>(msg-&gt;<a class="code" href="a01000.html#a9de1f2958f2bdc0d9ecfeb44c396c921">kind</a>) { </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">case</span> toNormal:</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      state = Normal;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      removeEvents();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordflow">if</span> (!immunity)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    scheduleAt(event_time(Normal,HPV),</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;           <span class="keyword">new</span> cMessageByHPV(toHPV,hpv));</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">case</span> toHPV:</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      state = HPV;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      ever_infected = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      removeEvents();</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      scheduleAt(event_time(HPV,Normal),</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;         <span class="keyword">new</span> cMessageByHPV(toNormal,hpv));</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      scheduleAt(event_time(HPV,CIN1),</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;         <span class="keyword">new</span> cMessageByHPV(toCIN1,hpv));</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      scheduleAt(event_time(HPV,CIN23),</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;         <span class="keyword">new</span> cMessageByHPV(toCIN23,hpv));</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">case</span> toCIN1:</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      state = CIN1;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      removeEvents();</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      scheduleAt(event_time(CIN1,Normal),</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;         <span class="keyword">new</span> cMessageByHPV(toNormal,hpv));</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">if</span> (!immunity)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    scheduleAt(event_time(CIN1,HPV),</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;           <span class="keyword">new</span> cMessageByHPV(toHPV,hpv));</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      scheduleAt(event_time(CIN1,CIN23),</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;         <span class="keyword">new</span> cMessageByHPV(toCIN23,hpv));</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">case</span> toCIN23:</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      state = CIN23;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      removeEvents();</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      scheduleAt(event_time(CIN1,Normal),</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;         <span class="keyword">new</span> cMessageByHPV(toNormal,hpv));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keywordflow">if</span> (!immunity)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    scheduleAt(event_time(CIN1,HPV),</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;           <span class="keyword">new</span> cMessageByHPV(toHPV,hpv));</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      scheduleAt(event_time(CIN1,CIN23),</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;         <span class="keyword">new</span> cMessageByHPV(toCIN23,hpv));</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">case</span> toLocalCancer:</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      state = LocalCancer;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      person-&gt;removeHPVevents();</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      person-&gt;scheduleAt(<a class="code" href="a00078.html#a4f5da079da642a3ab4bc28f4f307a9d1">now</a>(), <span class="keyword">new</span> <a class="code" href="a01000.html">cMessage</a>(toLocalCancer));</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    };</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">// void Person::add_costs(string item) {</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">//   costs.add(CostKey(item,cohort),now(),cost_parameters[item]);</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">// void Person::scheduleUtilityChange(double at, std::string category, bool transient, double sign) {</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">//   scheduleAt(at, new cMessageUtilityChange(sign*utility_estimates[category]));</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">//   if (transient) {</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">//     scheduleAt(at + utility_duration[category], </span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">//         new cMessageUtilityChange(-sign*utility_estimates[category]));</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">//   }</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="a00932.html#a4a89c9477a1ce549db410af42b46b430">Person::init</a>() {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// declarations</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// initialise state variables</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    dx = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// determine event times</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    in-&gt;rngNh-&gt;set();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// schedule natural history events</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordtype">double</span> aoc = in-&gt;rmu0.rand(R::runif(0.0,1.0));</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    scheduleAt(aoc, <a class="code" href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4a43bf220160ef4fab6642d26f5d28ac27">toOtherDeath</a>);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// schedule screening events</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// rngScreen-&gt;set();</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    in-&gt;rngNh-&gt;set();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// // utilities</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// // (i) set initial baseline utility</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// utility = 0.98;</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// // (ii) schedule changes in the baseline by age</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// scheduleAt(20.0, new cMessageUtility(0.97));</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// scheduleAt(40.0, new cMessageUtility(0.96));</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// scheduleAt(60.0, new cMessageUtility(0.95));</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// scheduleAt(80.0, new cMessageUtility(0.91));</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// // Mark, which reference do/should we use for this?</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// record some parameters using SimpleReport - too many for a tuple</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (id &lt; in-&gt;parameter[<span class="stringliteral">&quot;nLifeHistories&quot;</span>]) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;id&quot;</span>,<span class="keywordtype">double</span>(<span class="keywordtype">id</span>));</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;aoc&quot;</span>,aoc);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;cohort&quot;</span>,cohort);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="keywordtype">void</span> <a class="code" href="a00932.html#aaf2b11f162db3e1df6adb2816d69bcd9">Person::handleMessage</a>(<span class="keyword">const</span> <a class="code" href="a01000.html">cMessage</a>* msg) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">// by default, use the natural history RNG</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  in-&gt;rngNh-&gt;set();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">// declarations</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="comment">// reports</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">// if (bparameter[&quot;full_report&quot;])</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">//   report.add(FullState::Type(state, ext_grade, dx, psa&gt;=3.0, cohort), msg-&gt;kind, previousEventTime, age, utility);</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">if</span> (id &lt; in-&gt;parameter[<span class="stringliteral">&quot;nLifeHistories&quot;</span>]) { <span class="comment">// only record up to the first n individuals</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    out-&gt;lifeHistories.record(<span class="stringliteral">&quot;id&quot;</span>,<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    out-&gt;lifeHistories.record(<span class="stringliteral">&quot;time&quot;</span>,<a class="code" href="a00078.html#a4f5da079da642a3ab4bc28f4f307a9d1">now</a>());</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    out-&gt;lifeHistories.record(<span class="stringliteral">&quot;hpv&quot;</span>,-1.0);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    out-&gt;lifeHistories.record(<span class="stringliteral">&quot;event&quot;</span>,msg-&gt;<a class="code" href="a01000.html#a9de1f2958f2bdc0d9ecfeb44c396c921">kind</a>);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// handle messages by kind</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">switch</span>(msg-&gt;<a class="code" href="a01000.html#a9de1f2958f2bdc0d9ecfeb44c396c921">kind</a>) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4ae5932500ab326a0d3bdd87449bb48d33">toCancerDeath</a>:</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">// add_costs(&quot;CancerDeath&quot;); // cost for death, should this be zero???</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (id &lt; in-&gt;parameter[<span class="stringliteral">&quot;nLifeHistories&quot;</span>]) {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;dx&quot;</span>,dx);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;age_d&quot;</span>,<a class="code" href="a00078.html#a4f5da079da642a3ab4bc28f4f307a9d1">now</a>());</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;cancer_death&quot;</span>,1.0);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    Sim::stop_simulation();</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4a43bf220160ef4fab6642d26f5d28ac27">toOtherDeath</a>:</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (id &lt; in-&gt;parameter[<span class="stringliteral">&quot;nLifeHistories&quot;</span>]) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;dx&quot;</span>,dx);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;age_d&quot;</span>,<a class="code" href="a00078.html#a4f5da079da642a3ab4bc28f4f307a9d1">now</a>());</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      out-&gt;outParameters.record(<span class="stringliteral">&quot;cancer_death&quot;</span>,0.0);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    Sim::stop_simulation();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">case</span> toLocalCancer:</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    state = LocalCancer;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// progression?</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">case</span> toRegionalCancer:</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    state = RegionalCancer;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// progression?</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">case</span> toDistantCancer:</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    state = DistantCancer;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// progression?</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="comment">// case toUtility:</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">//   {</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="comment">//     const cMessageUtility * msgUtility;</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="comment">//     if ((msgUtility = dynamic_cast&lt;const cMessageUtility *&gt;(msg)) != 0) { </span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">//    utility = msgUtility-&gt;utility;</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="comment">//     } else {</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">//    REprintf(&quot;Could not cast to cMessageUtility.&quot;);</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">//     }</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">//   } break;</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">// case toUtilityChange:</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">//   {</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">//     const cMessageUtilityChange * msgUtilityChange;</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">//     if ((msgUtilityChange = dynamic_cast&lt;const cMessageUtilityChange *&gt;(msg)) != 0) { </span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">//    utility += msgUtilityChange-&gt;change;</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">//     } else {</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">//    REprintf(&quot;Could not cast to cMessageUtilityChange.&quot;);</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">//     }</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">//   } break;</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    REprintf(<span class="stringliteral">&quot;No valid kind of event: %i\n&quot;</span>,msg-&gt;<a class="code" href="a01000.html#a9de1f2958f2bdc0d9ecfeb44c396c921">kind</a>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  } <span class="comment">// switch</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;} <span class="comment">// handleMessage()</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;RcppExport SEXP callCervical(SEXP parmsIn) {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// declarations</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  Person person;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  HPV_infection lr_hpv, hpv_16, hpv_18, other_hr_hpv;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  SimInput in;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  SimOutput out;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  in.rngNh-&gt;set();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="comment">// read in the parameters</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  List parms(parmsIn);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  List tables = parms[<span class="stringliteral">&quot;tables&quot;</span>];</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  in.parameter = parms[<span class="stringliteral">&quot;parameter&quot;</span>];</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  in.bparameter = parms[<span class="stringliteral">&quot;bparameter&quot;</span>]; <span class="comment">// scalar bools</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  List otherParameters = parms[<span class="stringliteral">&quot;otherParameters&quot;</span>];</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  in.debug = as&lt;bool&gt;(in.bparameter[<span class="stringliteral">&quot;debug&quot;</span>]);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  NumericVector mu0 = as&lt;NumericVector&gt;(otherParameters[<span class="stringliteral">&quot;mu0&quot;</span>]);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">// cost_parameters = as&lt;NumericVector&gt;(otherParameters[&quot;cost_parameters&quot;]);</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="comment">// utility_estimates = as&lt;NumericVector&gt;(otherParameters[&quot;utility_estimates&quot;]);</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="comment">// utility_duration = as&lt;NumericVector&gt;(otherParameters[&quot;utility_duration&quot;]);</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    in.H.clear(); </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    DataFrame df_H = as&lt;DataFrame&gt;(tables[<span class="stringliteral">&quot;H&quot;</span>]); <span class="comment">// age,hpv,from_state,to_state,survival</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// extract the columns</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    IntegerVector hpv = df_H[<span class="stringliteral">&quot;hpv&quot;</span>],</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      from_state = df_H[<span class="stringliteral">&quot;from_state&quot;</span>],</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      to_state = df_H[<span class="stringliteral">&quot;to_state&quot;</span>];</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    NumericVector age = df_H[<span class="stringliteral">&quot;age&quot;</span>],</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      survival = df_H[<span class="stringliteral">&quot;survival&quot;</span>];</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keyword">typedef</span> pair&lt;double,double&gt; dpair;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">// push to the map values and set of ages</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;age.size(); ++i) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      in.H[H_key((hpv_t) hpv[i], (<a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a>) from_state[i], (<a class="code" href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">state_t</a>) to_state[i])].push_back(dpair(age[i],-log(survival[i])));</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// prepare the map values for lookup</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">for</span> (H_t::iterator <a class="code" href="a00011.html#ad18657ebbe6ccb6300be21945857104b">it</a> = in.H.begin(); <a class="code" href="a00011.html#ad18657ebbe6ccb6300be21945857104b">it</a> != in.H.end(); <a class="code" href="a00011.html#ad18657ebbe6ccb6300be21945857104b">it</a>++) </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <a class="code" href="a00011.html#ad18657ebbe6ccb6300be21945857104b">it</a>-&gt;second.prepare();</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="comment">// to use: event_time(from_state,to_state)</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  NumericVector cohort = as&lt;NumericVector&gt;(parms[<span class="stringliteral">&quot;cohort&quot;</span>]); <span class="comment">// at present, this is the only chuck-specific data</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="comment">// set up the parameters</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordtype">double</span> ages0[106];</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  boost::algorithm::iota(ages0, ages0+106, 0.0);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  in.rmu0 = <a class="code" href="a01012.html">Rpexp</a>(&amp;mu0[0], ages0, 106);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  vector&lt;double&gt; ages(101);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  boost::algorithm::iota(ages.begin(), ages.end(), 0.0);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  ages.push_back(1.0e+6);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">// re-set the output objects</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// report.clear();</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// costs.clear();</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  out.outParameters.clear();</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  out.lifeHistories.clear();</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// report.discountRate = parameter[&quot;discountRate.effectiveness&quot;];</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">// report.setPartition(ages);</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// costs.discountRate = parameter[&quot;discountRate.costs&quot;];</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">// costs.setPartition(ages);</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">// main loop</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; in.parameter[<span class="stringliteral">&quot;n&quot;</span>]; ++i) { </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">// define infections</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordtype">int</span> <span class="keywordtype">id</span> = i+as&lt;int&gt;(in.parameter[<span class="stringliteral">&quot;firstID&quot;</span>]);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    lr_hpv = HPV_infection(LR_HPV);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    hpv_16 = HPV_infection(HPV_16);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    hpv_18 = HPV_infection(HPV_18);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    other_hr_hpv = HPV_infection(Other_HR_HPV);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// define person</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    person = Person(&amp;in,&amp;out,<span class="keywordtype">id</span>,cohort[i]);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// link infections to the person</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    person.link(&amp;lr_hpv);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    person.link(&amp;hpv_16);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    person.link(&amp;hpv_18);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    person.link(&amp;other_hr_hpv);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="comment">// create processes</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    Sim::create_process(&amp;person);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    Sim::create_process(&amp;lr_hpv);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    Sim::create_process(&amp;hpv_16);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    Sim::create_process(&amp;hpv_18);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    Sim::create_process(&amp;other_hr_hpv);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">// run!!</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    Sim::run_simulation();</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">// tidy up</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    Sim::clear();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    in.rngNh-&gt;nextSubstream();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    in.rngOther-&gt;nextSubstream();</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    in.rngScreen-&gt;nextSubstream();</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    in.rngTreatment-&gt;nextSubstream();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">if</span> (i % 10000 == 0) Rcpp::checkUserInterrupt(); <span class="comment">/* be polite -- did the user hit ctrl-C? */</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="comment">// output</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">// TODO: clean up these objects in C++ (cf. R)</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">return</span> List::create(</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;              <span class="comment">// _(&quot;costs&quot;) = costs.wrap(),                // CostReport</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;              <span class="comment">// _(&quot;summary&quot;) = report.wrap(),             // EventReport </span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;              _(<span class="stringliteral">&quot;lifeHistories&quot;</span>) = out.lifeHistories.wrap(), <span class="comment">// SimpleReport&lt;double&gt;</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;              _(<span class="stringliteral">&quot;parameters&quot;</span>) = out.outParameters.wrap()     <span class="comment">// SimpleReport&lt;double&gt;</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;              );</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;} <span class="comment">// anonymous namespace</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aa00077_html_a0395c8bb2ea9d6445cf7c1a9671655c4ae5932500ab326a0d3bdd87449bb48d33"><div class="ttname"><a href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4ae5932500ab326a0d3bdd87449bb48d33">illnessDeath::toCancerDeath</a></div><div class="ttdeci">@ toCancerDeath</div><div class="ttdef"><b>Definition:</b> <a href="a00017_source.html#l00011">illness-death.cpp:11</a></div></div>
<div class="ttc" id="aa00932_html_a4a89c9477a1ce549db410af42b46b430"><div class="ttname"><a href="a00932.html#a4a89c9477a1ce549db410af42b46b430">Person::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition:</b> <a href="a00005_source.html#l00098">person-r-20121231.cc:98</a></div></div>
<div class="ttc" id="aa00011_html_ad18657ebbe6ccb6300be21945857104b"><div class="ttname"><a href="a00011.html#ad18657ebbe6ccb6300be21945857104b">it</a></div><div class="ttdeci">GNU Free Documentation License March Inc Temple MA USA Everyone is permitted to copy and distribute verbatim copies of this license but changing it is not allowed PREAMBLE The purpose of this License is to make a or other written document free in the sense of with or without modifying it</div><div class="ttdef"><b>Definition:</b> <a href="a00011_source.html#l00015">fdl.txt:15</a></div></div>
<div class="ttc" id="aa01016_html"><div class="ttname"><a href="a01016.html">ssim::Rng</a></div><div class="ttdef"><b>Definition:</b> <a href="a00056_source.html#l00393">microsimulation.h:393</a></div></div>
<div class="ttc" id="aa00078_html_a4f5da079da642a3ab4bc28f4f307a9d1"><div class="ttname"><a href="a00078.html#a4f5da079da642a3ab4bc28f4f307a9d1">ssim::now</a></div><div class="ttdeci">Time now()</div><div class="ttdoc">now() function for compatibility with C++SIM</div><div class="ttdef"><b>Definition:</b> <a href="a00023_source.html#l00014">microsimulation.cc:14</a></div></div>
<div class="ttc" id="aa01004_html"><div class="ttname"><a href="a01004.html">ssim::cProcess</a></div><div class="ttdoc">cProcess class for OMNET++ API compatibility. This provides a default for Process::process_event() th...</div><div class="ttdef"><b>Definition:</b> <a href="a00056_source.html#l00236">microsimulation.h:236</a></div></div>
<div class="ttc" id="aa00005_html_a17026bec7f574bca918d5f81939429bcab5c539648669b55ca8979ff5796e23d9"><div class="ttname"><a href="a00005.html#a17026bec7f574bca918d5f81939429bcab5c539648669b55ca8979ff5796e23d9">Death</a></div><div class="ttdeci">@ Death</div><div class="ttdef"><b>Definition:</b> <a href="a00005_source.html#l00041">person-r-20121231.cc:41</a></div></div>
<div class="ttc" id="aa00088_html"><div class="ttname"><a href="a00088.html">Rcpp</a></div><div class="ttdef"><b>Definition:</b> <a href="a00056_source.html#l00077">microsimulation.h:77</a></div></div>
<div class="ttc" id="aa00056_html"><div class="ttname"><a href="a00056.html">microsimulation.h</a></div></div>
<div class="ttc" id="aa01076_html"><div class="ttname"><a href="a01076.html">ssim::Event</a></div><div class="ttdoc">basic event in the simulation.</div><div class="ttdef"><b>Definition:</b> <a href="a00065_source.html#l00111">ssim.h:111</a></div></div>
<div class="ttc" id="aa01032_html"><div class="ttname"><a href="a01032.html">ssim::SimpleReport</a></div><div class="ttdoc">SimpleReport class for collecting data for homogeneous fields of type T with string names.</div><div class="ttdef"><b>Definition:</b> <a href="a00056_source.html#l00921">microsimulation.h:921</a></div></div>
<div class="ttc" id="aa00077_html_a0395c8bb2ea9d6445cf7c1a9671655c4a43bf220160ef4fab6642d26f5d28ac27"><div class="ttname"><a href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4a43bf220160ef4fab6642d26f5d28ac27">illnessDeath::toOtherDeath</a></div><div class="ttdeci">@ toOtherDeath</div><div class="ttdef"><b>Definition:</b> <a href="a00017_source.html#l00011">illness-death.cpp:11</a></div></div>
<div class="ttc" id="aa01012_html"><div class="ttname"><a href="a01012.html">ssim::Rpexp</a></div><div class="ttdoc">Rpexp is a random number generator class for piecewise constant hazards. Given time lower bounds t an...</div><div class="ttdef"><b>Definition:</b> <a href="a00056_source.html#l00336">microsimulation.h:336</a></div></div>
<div class="ttc" id="aa01000_html_a9de1f2958f2bdc0d9ecfeb44c396c921"><div class="ttname"><a href="a01000.html#a9de1f2958f2bdc0d9ecfeb44c396c921">ssim::cMessage::kind</a></div><div class="ttdeci">short kind</div><div class="ttdef"><b>Definition:</b> <a href="a00056_source.html#l00199">microsimulation.h:199</a></div></div>
<div class="ttc" id="aa00077_html_a0395c8bb2ea9d6445cf7c1a9671655c4"><div class="ttname"><a href="a00077.html#a0395c8bb2ea9d6445cf7c1a9671655c4">illnessDeath::event_t</a></div><div class="ttdeci">event_t</div><div class="ttdef"><b>Definition:</b> <a href="a00017_source.html#l00011">illness-death.cpp:11</a></div></div>
<div class="ttc" id="aa00932_html_aaf2b11f162db3e1df6adb2816d69bcd9"><div class="ttname"><a href="a00932.html#aaf2b11f162db3e1df6adb2816d69bcd9">Person::handleMessage</a></div><div class="ttdeci">virtual void handleMessage(const cMessage *msg)</div><div class="ttdef"><b>Definition:</b> <a href="a00005_source.html#l00107">person-r-20121231.cc:107</a></div></div>
<div class="ttc" id="aa00077_html_a7808099d48e55554a94f8d5ed5215f6c"><div class="ttname"><a href="a00077.html#a7808099d48e55554a94f8d5ed5215f6c">illnessDeath::state_t</a></div><div class="ttdeci">state_t</div><div class="ttdef"><b>Definition:</b> <a href="a00017_source.html#l00009">illness-death.cpp:9</a></div></div>
<div class="ttc" id="aa00078_html"><div class="ttname"><a href="a00078.html">ssim</a></div><div class="ttdoc">name space for the Siena simulator.</div><div class="ttdef"><b>Definition:</b> <a href="a00023_source.html#l00008">microsimulation.cc:8</a></div></div>
<div class="ttc" id="aa01000_html"><div class="ttname"><a href="a01000.html">ssim::cMessage</a></div><div class="ttdoc">cMessage class for OMNET++ API compatibility. This provides a heavier message class than Sim::Event,...</div><div class="ttdef"><b>Definition:</b> <a href="a00056_source.html#l00191">microsimulation.h:191</a></div></div>
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 17 2021 11:00:41 for Microsimulation API by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
